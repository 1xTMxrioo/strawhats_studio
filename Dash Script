local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local dashing = false
local cooldown = false

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end

	-- Check if sliding (prevent dash while sliding)
	local slideScript = player:WaitForChild("PlayerScripts"):FindFirstChild("SlideScript")
	local isSliding = false
	if slideScript and slideScript:IsA("LocalScript") then
		-- Simple check - if walk speed is 45, assume sliding
		local character = player.Character
		if character then
			local humanoid = character:FindFirstChildOfClass("Humanoid")
			if humanoid and humanoid.WalkSpeed == 45 then
				isSliding = true
			end
		end
	end

	if input.KeyCode == Enum.KeyCode.Q and not dashing and not cooldown and not isSliding then
		dashing = true
		cooldown = true

		local character = player.Character
		if not character then return end

		local humanoid = character:FindFirstChildOfClass("Humanoid")
		if not humanoid then return end

		-- Store current FOV to restore properly
		local currentFOV = workspace.CurrentCamera.FieldOfView

		-- Camera zoom effect
		for i = 1, 3 do
			workspace.CurrentCamera.FieldOfView = currentFOV + (i * 3)
			task.wait(0.02)
		end

		-- Apply dash speed
		humanoid.WalkSpeed = 70

		-- Wait for dash duration
		task.wait(0.4)

		-- Restore correct speed (respecting sprint state)
		if _G.restoreSprintSpeed then
			_G.restoreSprintSpeed()
		else
			humanoid.WalkSpeed = 16
		end

		-- Reverse camera zoom
		for i = 1, 3 do
			workspace.CurrentCamera.FieldOfView = currentFOV + 9 - (i * 3)
			task.wait(0.02)
		end

		dashing = false

		-- Start cooldown
		task.wait(3)
		cooldown = false
	end
end)
